<?xml version="1.0"?>

<!-- 
/**
 * @category   Webshopapps
 * @copyright  Copyright (c) 2011 Zowta Ltd (http://www.webshopapps.com)
 * @license    http://www.webshopapps.com/license/license.txt - Commercial license
 */
 -->
<config>
    <modules>
        <Webshopapps_Dropship>
            <version>3.0.23</version>
        </Webshopapps_Dropship>
    </modules>
    <frontend>
        <routers>
            <webshopapps_dropship>
                <use>standard</use>
                <args>
                    <module>Webshopapps_Dropship</module>
                    <frontName>dropship</frontName>
                </args>
            </webshopapps_dropship>
            <checkout>
            	<args>
            		<modules>
        				<Webshopapps_Dropship before="Mage_Checkout">Webshopapps_Dropship_Checkout</Webshopapps_Dropship>
      				</modules>
            	</args>
            </checkout>
        </routers>
        <layout>
            <updates>
                <dropship>
                    <file>webshopapps_dropship.xml</file>
                </dropship>
            </updates>
        </layout>
       	<translate>
            <modules>
                <Webshopapps_Dropship>
                    <files>
                        <default>Webshopapps_Dropship.csv</default>
                    </files>
                </Webshopapps_Dropship>
            </modules>
        </translate>
    </frontend>
    <admin>
        <routers>
			<dropship>
				<use>admin</use>
				<args>
					<module>Webshopapps_Dropship</module>
					<frontName>dropship</frontName>
				</args>
			</dropship>
        </routers>
    </admin>
    <adminhtml>
	  	<layout>
			<updates>
				<dropship module="Webshopapps_Dropship" >
					<file>webshopapps_dropship.xml</file>
				</dropship>
			</updates>
		</layout>
		<translate>
            <modules>
                <Webshopapps_Dropship>
                    <files>
                        <default>Webshopapps_Dropship.csv</default>
                    </files>
                </Webshopapps_Dropship>
            </modules>
        </translate>
    </adminhtml>   
    <global>
        <models>
            <dropship>
                <class>Webshopapps_Dropship_Model</class>
                <resourceModel>dropship_mysql4</resourceModel>
            </dropship>
           	<dropship_shipping>
				<class>Webshopapps_Dropship_Model</class>
			</dropship_shipping>
            <dropship_mysql4>
                <class>Webshopapps_Dropship_Model_Mysql4</class>
                <entities>
                    <dropship>
                        <table>dropship</table>
                    </dropship>
                    <dropship_shipping>
                        <table>dropship_shipping</table>
                    </dropship_shipping>
                    <shipmethods>
                     	<table>webshopapps_shipmethods</table>
                    </shipmethods>
                    <shipmethods_carriers>
                    	<table>webshopapps_shipmethods_carriers</table>
                    </shipmethods_carriers>
                    <shipmethods_upscarriers>
                    	<table>webshopapps_sm_upscarriers</table>
                    </shipmethods_upscarriers>
                </entities>
            </dropship_mysql4>
          	<sales>
	        	<rewrite>
	        		<order_shipment>Webshopapps_Dropship_Model_Sales_Order_Shipment</order_shipment>
	        	 	<quote_address>Webshopapps_Dropship_Model_Sales_Quote_Address</quote_address> 
	            	<quote_address_rate>Webshopapps_Dropship_Model_Sales_Quote_Address_Rate</quote_address_rate>
	            	<quote_address_total_shipping>Webshopapps_Dropship_Model_Sales_Quote_Address_Total_Shipping</quote_address_total_shipping>
	        	</rewrite>
       	 	</sales>
       	  	<shipping>
       	 		<rewrite>
       	 			<shipping>Webshopapps_Wsacommon_Model_Shipping_Shipping</shipping>
       	 		</rewrite> 
       	 	</shipping> 
       	 	<checkout>
 	        	<rewrite>
	        		<type_onepage>Webshopapps_Dropship_Model_Checkout_Type_Onepage</type_onepage>
	        	</rewrite>
      	 	</checkout>
        </models>
        <resources>
            <dropship_setup>
                <setup>
                    <module>Webshopapps_Dropship</module>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </dropship_setup>
            <dropship_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </dropship_write>
            <dropship_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </dropship_read>
        </resources>
        <blocks>
            <dropship>
                <class>Webshopapps_Dropship_Block</class>
            </dropship>
            <adminhtml>
                <rewrite>
                    <sales_order_shipment_view>Webshopapps_Dropship_Block_Adminhtml_Sales_Order_Shipment_View</sales_order_shipment_view>
                </rewrite>
            </adminhtml> 
        </blocks>
        <helpers>
            <dropship>
                <class>Webshopapps_Dropship_Helper</class>
            </dropship>
        </helpers> 
        <fieldsets>
        	<sales_convert_order>
                <warehouse><to_quote_address_shipping>*</to_quote_address_shipping></warehouse>
                <warehouse_shipping_details><to_quote_address_shipping>*</to_quote_address_shipping></warehouse_shipping_details>
                <warehouse_shipping_html><to_quote_address_shipping>*</to_quote_address_shipping></warehouse_shipping_html>
        	</sales_convert_order>
           <sales_convert_quote_address>
                 <warehouse><to_order>*</to_order></warehouse>     		
                 <warehouse_shipping_details><to_order>*</to_order></warehouse_shipping_details>     		
                 <warehouse_shipping_html><to_order>*</to_order></warehouse_shipping_html>     		
      		</sales_convert_quote_address>
      		<sales_convert_quote_item>
		                 <warehouse><to_order_item>*</to_order_item></warehouse>   
		            </sales_convert_quote_item>  
		            <sales_convert_order_item>
		                <warehouse><to_quote_item>*</to_quote_item></warehouse>
        	</sales_convert_order_item>
         </fieldsets>  
         <events>
            <sales_order_place_after>
   	          <observers>
   	              <dropship_observer>
   	                  <type>singleton</type>
   	                  <class>dropship/observer</class>
   	                  <method>saveOrderAfter</method>
   	              </dropship_observer>
   	          </observers>
            </sales_order_place_after>
             <sales_convert_quote_item_to_order_item>
               <observers>
                 <dropship_observer>
	                <type>singleton</type>
	                <class>dropship/observer</class>
	                <method>salesConvertQuoteItemToOrderItem</method>
	             </dropship_observer>
               </observers>
           </sales_convert_quote_item_to_order_item>
            <sales_order_invoice_save_after>
    	          <observers>
    	              <dropship_observer>
    	                  <type>singleton</type>
    	                  <class>dropship/observer</class>
    	                  <method>saveOrderAfter</method>
    	              </dropship_observer>
    	          </observers>
            </sales_order_invoice_save_after>
            <checkout_cart_save_before>
   	          <observers>
   	              <dropship_observer>
   	                  <type>singleton</type>
   	                  <class>dropship/observer</class>
   	                  <method>saveCartBefore</method>
   	              </dropship_observer>
   	          </observers>
            </checkout_cart_save_before>
            <adminhtml_block_html_before>
                <observers>
                    <dropship_observer>
                        <class>dropship/adminhtml_observer</class>
                        <method>onBlockHtmlBefore</method>
                    </dropship_observer>
                </observers>
            </adminhtml_block_html_before>
            <sales_order_shipment_grid_collection_load_before>
                <observers>
                    <dropship_observer>
                        <class>dropship/adminhtml_observer</class>
                        <method>onSalesOrderShipmentGridLoadBefore</method>
                    </dropship_observer>
                </observers>
            </sales_order_shipment_grid_collection_load_before>
         </events>
          <sales>
			<shipping>
			    <carriers>
					<dropship>
						<class>Webshopapps_Dropship_Model_Carrier_Dropship</class>
					</dropship>
			    </carriers>
			</shipping>
    	  </sales> 
    	  <template>
            <email>
             <wsa_email_shipment_template translate="label" module="sales">
                   <label>New Warehouse Shipment</label>
                   <file>sales/wsa_shipment_new.html</file>
                   <type>html</type>
               </wsa_email_shipment_template>
            </email>
          </template>
		  <sales>
		    <quote>
		      <item>
		        <product_attributes>
		          <warehouse/>
		        </product_attributes>
		      </item>
		    </quote>
		  </sales>
		 
    </global>
    <default>
  		<carriers>
        	<dropship>
                <active>0</active>
                <sallowspecific>0</sallowspecific>
                <model>dropship_shipping/carrier_dropship</model>
                <title>Dropship</title>
				<ship_once>0</ship_once>
                <name>Webshopapps Dropship Shipping</name>
                <specificerrmsg>This shipping method is currently unavailable. If you would like to ship using this shipping method, please contact us.</specificerrmsg>
                <all_separate>0</all_separate>
                <merged_checkout>1</merged_checkout>      
                <help_text>Your order is being shipped from multiple sites</help_text>
                <help_url>home</help_url>
                <showmethod>1</showmethod>
                <warehouse_desc>Warehouse</warehouse_desc>
                <show_price>0</show_price>
	        	<serial backend_model="adminhtml/system_config_backend_encrypted"/>
                <repeat_req>0</repeat_req>          
                <use_parent>1</use_parent>
                <show_all_items>0</show_all_items>
				<shipment_email>never</shipment_email>	
				<restrict_overnight>0</restrict_overnight>	
				<use_cart_price>0</use_cart_price>
				<weight_unit_to_display>lbs</weight_unit_to_display>	
                <instock_default>0</instock_default>
                <ignore_shipping>0</ignore_shipping>
            </dropship>
        </carriers>
        <sales_order>
        	<dropship_order>
        		<enabled>1</enabled>
        	</dropship_order>
        	<dropship_order_comment>
        		<enabled>1</enabled>
        	</dropship_order_comment>
        </sales_order>
  	</default>
</config>